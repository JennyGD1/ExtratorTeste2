<!DOCTYPE html>
<html lang="pt-br">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/index.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/formulario.css') }}">
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cadastro Familiar - Maida Health</title>
    <link rel="icon" href="{{ url_for('static', filename='img/logo_maida.png') }}" />
</head>
<body class="page-index">
    {% include '_preloader.html' %}
    <div class="logo">
        <img src="{{ url_for('static', filename='img/logo_maida.png') }}" alt="Logo da Maida Health" loading="lazy">
    </div>
    <main>
        <div class="borda-animada">
            <div class="content-box">
                <h1>Cadastro do Grupo Familiar</h1>
                
                <form id="familia-form" method="POST" action="/contracheques">
                    <div class="form-group">
                        <label for="tamanho-familia">Tamanho do Grupo Familiar:</label>
                        <select id="tamanho-familia" name="tamanho_familia" required>
                            <option value="" disabled selected>Selecione a quantidade</option>
                            <option value="1">1 - Apenas titular</option>
                            <option value="2">2 - Titular + 1</option>
                            <!-- ... manter as outras opções ... -->
                        </select>
                    </div>

                    <div id="conjuge-container" class="hidden">
                        <div class="form-group">
                            <input type="checkbox" id="incluir-conjuge" name="incluir_conjuge">
                            <label for="incluir-conjuge">Incluir cônjuge/companheiro(a)</label>
                        </div>
                    </div>

                    <div id="dependentes-container" class="hidden">
                        <h3>Dependentes e Agregados</h3>
                        <div id="dependentes-lista"></div>
                        <button type="button" id="adicionar-dependente" class="btn-secondary">+ Adicionar Dependente</button>
                    </div>

                    <div class="form-group">
                        <button type="submit" class="process-btn">Continuar para Contracheques</button>
                    </div>
                </form>
            </div>
        </div>
    </main>
    <footer>
        Desenvolvido por Jennifer Lima
    </footer>

    <div class="bg-shapes">
        <svg viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">
            <g transform="translate(300,300)">
                <path d="M150,-164C198,-122,235,-61,230,-4.6C225,51,178,102,130,146C82,190,34,228,-20,236C-73,244,-145,221,-176,172C-207,123,-197,48,-180,-20C-163,-89,-138,-151,-94,-190C-50,-229,13,-244,75,-231C137,-218,199,-176,150,-164Z" fill="rgba(255, 255, 255, 0.05)"/>
            </g>
        </svg>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Elementos do DOM
            const tamanhoFamilia = document.getElementById('tamanho-familia');
            const conjugeContainer = document.getElementById('conjuge-container');
            const dependentesContainer = document.getElementById('dependentes-container');
            const dependentesLista = document.getElementById('dependentes-lista');
            const btnAdicionarDependente = document.getElementById('adicionar-dependente');

            // Atualizar interface quando o tamanho da família muda
            tamanhoFamilia.addEventListener('change', function() {
                const qtd = parseInt(this.value);
                const maxDependentes = Math.max(0, qtd - 1);
                
                if (qtd > 1) {
                    conjugeContainer.classList.remove('hidden');
                    dependentesContainer.classList.remove('hidden');
                } else {
                    conjugeContainer.classList.add('hidden');
                    dependentesContainer.classList.add('hidden');
                }
                
                dependentesLista.innerHTML = '';
                btnAdicionarDependente.disabled = maxDependentes === 0;
            });

            // Adicionar novo dependente (mantido igual)
            btnAdicionarDependente.addEventListener('click', function() {
                const qtd = parseInt(tamanhoFamilia.value);
                const maxDependentes = qtd - 1;
                const currentDependentes = document.querySelectorAll('.dependente-item').length;
                
                if (currentDependentes >= maxDependentes) {
                    alert(`Você pode adicionar no máximo ${maxDependentes} dependentes.`);
                    return;
                }
                
                const dependenteId = Date.now();
                const dependenteHTML = `
                    <div class="dependente-item" id="dependente-${dependenteId}">
                        <div class="form-row">
                            <!-- ... manter o conteúdo do dependente igual ... -->
                        </div>
                    </div>
                `;
                
                dependentesLista.insertAdjacentHTML('beforeend', dependenteHTML);
                btnAdicionarDependente.disabled = currentDependentes + 1 >= maxDependentes;
                
                // Configurar eventos para os novos elementos
                document.getElementById(`interrompido-${dependenteId}`).addEventListener('change', function() {
                    const dataInterrupcao = document.getElementById(`data-interrupcao-${dependenteId}`);
                    dataInterrupcao.classList.toggle('hidden', !this.checked);
                });
                
                document.querySelector(`button[data-id="${dependenteId}"]`).addEventListener('click', function() {
                    document.getElementById(`dependente-${this.dataset.id}`).remove();
                    btnAdicionarDependente.disabled = false;
                });
            });
        });
         // Adicionar evento de submit do formulário
        document.getElementById('familia-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Coletar dados do formulário
            const formData = {
                tamanho_familia: document.getElementById('tamanho-familia').value,
                incluir_conjuge: document.getElementById('incluir-conjuge').checked,
                dependentes: []
            };

            // Coletar dados dos dependentes
            document.querySelectorAll('.dependente-item').forEach(dep => {
                const id = dep.id.split('-')[1];
                formData.dependentes.push({
                    nome: document.getElementById(`nome-${id}`).value,
                    tipo: document.getElementById(`tipo-${id}`).value,
                    nascimento: document.getElementById(`nascimento-${id}`).value,
                    risco: document.getElementById(`risco-${id}`).checked,
                    interrompido: document.getElementById(`interrompido-${id}`).checked,
                    data_exclusao: document.getElementById(`data-exclusao-${id}`).value
                });
            });

            // Simular envio para o servidor (substituir por fetch real se necessário)
            console.log('Dados enviados:', formData);
            
            // Redirecionar para contracheques.html com os parâmetros
            const queryParams = new URLSearchParams();
            queryParams.append('tamanho', formData.tamanho_familia);
            queryParams.append('incluir_conjuge', formData.incluir_conjuge);
            queryParams.append('num_dependentes', formData.dependentes.length);
            
            window.location.href = `/contracheques.html?${queryParams.toString()}`;
        });
    });
    </script>
</body>
</html>
