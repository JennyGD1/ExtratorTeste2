<!DOCTYPE html>
<html lang="pt-br">
<head>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
   <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Extrator de Contracheques - Maida Health</title>
  <link rel="icon" href="{{ url_for('static', filename='img/logo_maida.png') }}" />

 </head>
<body class="page-index">
  {% include '_preloader.html' %}
        <div class="logo">
      <img src="{{ url_for('static', filename='img/logo_maida.png') }}" alt="Logo da Maida Health" loading="lazy">
    </div>
    <main>
      <div class="borda-animada">
        <div class="content-box">
          <h1><strong>Calculadora de Mensalidades</strong></h1>
          <input type="file" id="file-upload" multiple hidden aria-label="Selecionar arquivos" />
          <label for="file-upload" class="upload-btn">üìÅ Escolher Arquivos</label>
          <p id="file-name" class="file-name" aria-live="polite">Nenhum arquivo selecionado</p>
          <button type="button" class="process-btn" aria-busy="false">Processar</button>
          <progress id="upload-progress" value="0" max="100" hidden></progress>
        </div>
      </div>
    </main>
    <footer style="margin-top: auto; padding: 10px 0; text-align: center; font-size: 14px; color: var(--branco);">
      Desenvolvido por Jennifer Lima
    </footer>
   <div class="bg-shapes">
    <svg viewBox="0 0 600 600" xmlns="http://www.w3.org/2000/svg">
      <g transform="translate(300,300)">
        <path d="M150,-164C198,-122,235,-61,230,-4.6C225,51,178,102,130,146C82,190,34,228,-20,236C-73,244,-145,221,-176,172C-207,123,-197,48,-180,-20C-163,-89,-138,-151,-94,-190C-50,-229,13,-244,75,-231C137,-218,199,-176,150,-164Z" fill="rgba(255, 255, 255, 0.05)"/>
      </g>
    </svg>
  </div>
  <!-- ‚úÖ Scroll visual preenchido -->
<div class="scrollbar-container">
  <div class="scrollbar-thumb" id="scrollThumb"></div>
</div>
     <script>
document.addEventListener('DOMContentLoaded', () => {
  const fileInput = document.getElementById('file-upload');
  const fileNameText = document.getElementById('file-name');
  const processBtn = document.querySelector('.process-btn');
  const progressBar = document.getElementById('upload-progress');

  // Fun√ß√£o para verificar se o arquivo √© PDF
  function isPDF(file) {
    return file.type === 'application/pdf';
  }

  fileInput.addEventListener('change', function() {
    if (this.files.length === 0) {
      fileNameText.textContent = 'Nenhum arquivo selecionado';
      return;
    }

    // Verificar todos os arquivos selecionados
    const invalidFiles = Array.from(this.files).filter(file => !isPDF(file));
    
    if (invalidFiles.length > 0) {
      fileNameText.textContent = 'Por favor, selecione apenas arquivos PDF';
      this.value = ''; // Limpa a sele√ß√£o
      return;
    }

    if (this.files.length === 1) {
      fileNameText.textContent = this.files[0].name;
    } else {
      fileNameText.textContent = `${this.files.length} arquivos PDF selecionados`;
    }
  });

  processBtn.addEventListener('click', async function() {
    const files = fileInput.files;
    
    if (!files || files.length === 0) {
        fileNameText.textContent = 'Por favor, selecione pelo menos um arquivo PDF';
        return;
    }

    // Feedback visual
    this.disabled = true;
    this.setAttribute('aria-busy', 'true');
    this.innerHTML = `<span class="spinner"></span>Processando...`;
    progressBar.hidden = false;
    progressBar.value = 0;
    fileNameText.textContent = 'Enviando arquivos...';

    try {
        const formData = new FormData();
        Array.from(files).forEach(file => {
            formData.append('files', file); // Note que mudamos para 'files' (igual ao Flask)
        });

        // Alteramos para usar a rota /upload que existe no seu Flask
        const response = await fetch('/upload', {
            method: 'POST',
            body: formData
        });

        if (response.ok) {
            // N√£o precisa parsear JSON pois o Flask j√° redireciona
            window.location.href = "/resultados"; // Redireciona para a p√°gina de resultados
        } else {
            throw new Error('Erro no servidor');
        }
    } catch (error) {
        console.error('Erro:', error);
        fileNameText.textContent = 'Erro ao enviar arquivos. Tente novamente.';
    } finally {
        this.disabled = false;
        this.removeAttribute('aria-busy');
        this.innerHTML = 'Processar';
        progressBar.hidden = true;
    }
  });
});
</script>

  <script src="{{ url_for('static', filename='js/main.js') }}" defer></script>
</body>
</html>
